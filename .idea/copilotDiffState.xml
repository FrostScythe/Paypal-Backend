<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/api-gateway/src/main/java/com/paypal/api_gateway/filters/JwtAuthFilter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/api-gateway/src/main/java/com/paypal/api_gateway/filters/JwtAuthFilter.java" />
              <option name="originalContent" value="package com.paypal.api_gateway.filters;&#10;&#10;import com.paypal.api_gateway.util.JwtUtil;&#10;import io.jsonwebtoken.Claims;&#10;import org.springframework.cloud.gateway.filter.GatewayFilterChain;&#10;import org.springframework.cloud.gateway.filter.GlobalFilter;&#10;import org.springframework.core.Ordered;&#10;import org.springframework.http.HttpHeaders;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.stereotype.Component;&#10;import org.springframework.web.server.ServerWebExchange;&#10;import reactor.core.publisher.Mono;&#10;&#10;import java.util.List;&#10;&#10;&#10;@Component&#10;public class JwtAuthFilter implements GlobalFilter, Ordered {&#10;&#10;    private static final List&lt;String&gt; PUBLIC_PATHS = List.of(&#10;            &quot;/auth/signup&quot;,&#10;            &quot;/auth/login&quot;&#10;    );&#10;&#10;    @Override&#10;    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain){&#10;        String path = exchange.getRequest().getPath().value();&#10;        String normalizedPath = path.replaceAll(&quot;/+$&quot;, &quot;&quot;);&#10;&#10;        if(PUBLIC_PATHS.contains(normalizedPath)){&#10;            return chain.filter(exchange)&#10;                    .doOnSubscribe(s -&gt; System.out.println(&quot;Proceeding without check&quot;))&#10;                    .doOnSuccess(v -&gt; System.out.println(&quot;successfully passed&quot;))&#10;                    .doOnError(e -&gt; System.err.println(&quot;error occured&quot;));&#10;        }&#10;&#10;        String authHeader = exchange.getRequest().getHeaders().getFirst(HttpHeaders.AUTHORIZATION);&#10;&#10;        if(authHeader == null || !authHeader.startsWith(&quot;Bearer &quot;)){&#10;            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);&#10;            return exchange.getResponse().setComplete();&#10;        }&#10;&#10;        try{&#10;            String token = authHeader.substring(7);&#10;            Claims claims = JwtUtil.validateToken(token);&#10;            &#10;            ServerWebExchange mutatedExchange = exchange.mutate()&#10;                    .request(exchange.getRequest().mutate()&#10;                            .header(&quot;X-User-Email&quot;, claims.getSubject())&#10;                            .build())&#10;                    .build();&#10;&#10;            return chain.filter(mutatedExchange)&#10;                    .doOnSubscribe(s -&gt; System.out.println(&quot;Proceeding without check&quot;))&#10;                    .doOnSuccess(v -&gt; System.out.println(&quot;successfully passed&quot;))&#10;                    .doOnError(e -&gt; System.err.println(&quot;error occured&quot;));&#10;&#10;        }catch (Exception e){&#10;            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);&#10;            return exchange.getResponse().setComplete();&#10;        }&#10;&#10;    }&#10;&#10;    @Override&#10;    public int getOrder() {&#10;        return 0;&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.paypal.api_gateway.filters;&#10;&#10;import com.paypal.api_gateway.util.JwtUtil;&#10;import io.jsonwebtoken.Claims;&#10;import org.springframework.cloud.gateway.filter.GatewayFilterChain;&#10;import org.springframework.cloud.gateway.filter.GlobalFilter;&#10;import org.springframework.core.Ordered;&#10;import org.springframework.http.HttpHeaders;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.stereotype.Component;&#10;import org.springframework.web.server.ServerWebExchange;&#10;import reactor.core.publisher.Mono;&#10;&#10;import java.util.List;&#10;&#10;&#10;@Component&#10;public class JwtAuthFilter implements GlobalFilter, Ordered {&#10;&#10;    private static final List&lt;String&gt; PUBLIC_PATHS = List.of(&#10;            &quot;/auth/signup&quot;,&#10;            &quot;/auth/login&quot;&#10;    );&#10;&#10;    @Override&#10;    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain){&#10;        String path = exchange.getRequest().getPath().value();&#10;        String normalizedPath = path.replaceAll(&quot;/+$&quot;, &quot;&quot;);&#10;&#10;        if(PUBLIC_PATHS.contains(normalizedPath)){&#10;            return chain.filter(exchange)&#10;                    .doOnSubscribe(s -&gt; System.out.println(&quot;Proceeding without check&quot;))&#10;                    .doOnSuccess(v -&gt; System.out.println(&quot;successfully passed&quot;))&#10;                    .doOnError(e -&gt; System.err.println(&quot;error occured&quot;));&#10;        }&#10;&#10;        String authHeader = exchange.getRequest().getHeaders().getFirst(HttpHeaders.AUTHORIZATION);&#10;&#10;        if(authHeader == null || !authHeader.startsWith(&quot;Bearer &quot;)){&#10;            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);&#10;            return exchange.getResponse().setComplete();&#10;        }&#10;&#10;        try{&#10;            String token = authHeader.substring(7);&#10;            Claims claims = JwtUtil.validateToken(token);&#10;            &#10;            ServerWebExchange mutatedExchange = exchange.mutate()&#10;                    .request(exchange.getRequest().mutate()&#10;                            .header(&quot;X-User-Email&quot;, claims.getSubject())&#10;                            .build())&#10;                    .build();&#10;&#10;            return chain.filter(mutatedExchange)&#10;                    .doOnSubscribe(s -&gt; System.out.println(&quot;Proceeding without check&quot;))&#10;                    .doOnSuccess(v -&gt; System.out.println(&quot;successfully passed&quot;))&#10;                    .doOnError(e -&gt; System.err.println(&quot;error occured&quot;));&#10;&#10;        }catch (Exception e){&#10;            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);&#10;            return exchange.getResponse().setComplete();&#10;        }&#10;&#10;    }&#10;&#10;    @Override&#10;    public int getOrder() {&#10;        return 0;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>